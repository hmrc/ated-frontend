@import models._
@(summaryReturnsWithDrafts: SummaryReturnsModel, correspondence: Option[Address], organisationName: Option[String], clientBanner: Html)(implicit atedContext: AtedContext, messages: Messages)
@import utils._
@import utils.AtedUtils._
@import controllers.auth.ExternalUrls
@import views.html.helpers._


@atedMain(title = Messages("ated.summary-return.title"), attorney = atedContext.user.authContext.attorney,
  sidebarLinks = Some(_accountSummary_sideBar(summaryReturnsWithDrafts.atedBalance, correspondence, organisationName)),
  sidebarClass = Some("related"),
  banner = clientBanner) {

  @pageHeadersAndError(None, "client-summary-subheader", organisationName.getOrElse(""), "account-summary-header", Messages("ated.summary-return.header"))

<style>
  .grid-23-100 {
    width: 25%;
  }

  .grid-15-100 {
    width: 12%;
  }

</style>


  @if(summaryReturnsWithDrafts.allReturns.isEmpty) {
  <p><span class="heading-medium" id="return-summary-no-returns">@Messages("ated.account-summary.agent.no-returns")</span></p>
  } else {

<div class="form-group">
  <div class="grid-wrapper row-border">
    <div class="grid grid-23-100">
      <span id="return-summary-th-period" class="heading-small">@Messages("ated.account-summary-th.period")</span>
    </div>

    <div class="grid grid-23-100 ">
      <span id="return-summary-th-chargeable" class="heading-small">@Messages("ated.account-summary-th.chargeable")</span>
    </div>

    <div class="grid grid-15-100">
      <span id="return-summary-th-reliefs" class="heading-small">@Messages("ated.account-summary-th.reliefs")</span>
    </div>

    <div class="grid grid-15-100">
      <span id="return-summary-th-drafts" class="heading-small">@Messages("ated.account-summary-th.drafts")</span>
    </div>

    <div class="grid grid-23-100">
      <span id="return-summary-th-action" class="heading-small">@Messages("ated.period-summary-th.action")</span>
    </div>
  </div>

  @summaryReturnsWithDrafts.allReturns.zipWithIndex.map { case (periodSummaryWithDraft, i) =>

  <div class="form-group">
    <div class="grid-wrapper row-border">
      <div class="grid grid-23-100">
        <span class="screen-reader-text">@Messages("ated.account-summary-th.period")</span>
        <p>@periodSummaryWithDraft.periodKey to @(periodSummaryWithDraft.periodKey.toInt + 1)</p>
      </div>

      <div class="grid grid-23-100">
        <span class="screen-reader-text">@Messages("ated.account-summary-th.chargeable")</span>
        <p>@periodSummaryWithDraft.submittedReturns.fold(0)(a => a.currentLiabilityReturns.size + a.oldLiabilityReturns.size)</p>
      </div>

      <div class="grid grid-15-100">
        <span class="screen-reader-text">@Messages("ated.account-summary-th.reliefs")</span>
        <p>@periodSummaryWithDraft.submittedReturns.fold(0)(a => a.reliefReturns.size)</p>
      </div>

      <div class="grid grid-15-100">
        <span class="screen-reader-text">@Messages("ated.account-summary-th.drafts")</span>
        <p>@(periodSummaryWithDraft.draftReturns.size)</p>
      </div>

      <div class="grid grid-23-100">
        <p><a href="@controllers.routes.PeriodSummaryController.view(periodSummaryWithDraft.periodKey)" id="view-change-@i" data-journey-click="ated-fronted:click:view-change">@Messages("ated.account-summary.view-change-button")
          <span class="screen-reader-text">@periodSummaryWithDraft.periodKey-@(periodSummaryWithDraft.periodKey.toInt + 1)</span>
        </a></p>
      </div>

    </div>


  }
  }

  @if(!summaryReturnsWithDrafts.allReturns.isEmpty) {
    <p class="text">
      <a class="link" id="create-return" href="@controllers.routes.SelectPeriodController.view" data-journey-click="ated-fronted:click:create-return">@Messages("ated.account-summary.create-return.link")</a>
    </p>
  } else {
    @if(atedContext.user.authContext.attorney.isDefined) {
      <p class="text">
        <a class="button" id="create-return" href="@controllers.routes.SelectPeriodController.view" data-journey-click="ated-fronted:click:create-return">@Messages("ated.account-summary.create-return.button")</a>
      </p>
    } else {
      <div class="form-group">
        <p class="text" id="return-summary-no-returns-appoint-agent">@Messages("ated.account-summary.agent-appoint.text")</p>
        <p class="text" id="return-summary-no-returns-appoint-agent-info">@Messages("ated.account-summary.appoint-agent-info.text")</p>
        <a class="link" id="create-return" href="@controllers.routes.SelectPeriodController.view" data-journey-click="ated-fronted:click:create-return">@Messages("ated.account-summary.create-return.link")</a>
      </div>
    }
  }

  @if(atedContext.user.authContext.attorney.isEmpty && clientBanner == HtmlFormat.empty) {
  <p class="text">
    <a class="link" id="appoint-agent" href="@ExternalUrls.clientApproveAgentMandate">
      @Messages("ated.account-summary.appoint-agent.text")
    </a>
  </p>
  }

}
